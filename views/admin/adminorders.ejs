<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link href="/css/tailwind.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <%- include("../partials/admin/header") %>

  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4"><%= title %></h1>

    <!-- Search, Sort, and Filter -->
    <form method="GET" action="/admin/orders" class="mb-4 flex flex-wrap gap-4">
      <input type="text" name="search" value="<%= search %>" placeholder="Search by Order ID" class="p-2 border rounded">
      <select name="status" class="p-2 border rounded">
        <option value="">All Statuses</option>
        <option value="Pending" <%= statusFilter === 'Pending' ? 'selected' : '' %>>Pending</option>
        <option value="Processing" <%= statusFilter === 'Processing' ? 'selected' : '' %>>Processing</option>
        <option value="Shipped" <%= statusFilter === 'Shipped' ? 'selected' : '' %>>Shipped</option>
        <option value="Delivered" <%= statusFilter === 'Delivered' ? 'selected' : '' %>>Delivered</option>
        <option value="Cancelled" <%= statusFilter === 'Cancelled' ? 'selected' : '' %>>Cancelled</option>
        <option value="Return Request" <%= statusFilter === 'Return Request' ? 'selected' : '' %>>Return Request</option>
        <option value="Returned" <%= statusFilter === 'Returned' ? 'selected' : '' %>>Returned</option>
      </select>
      <select name="payment" class="p-2 border rounded">
        <option value="">All Payment Statuses</option>
        <option value="Pending" <%= paymentFilter === 'Pending' ? 'selected' : '' %>>Pending</option>
        <option value="Completed" <%= paymentFilter === 'Completed' ? 'selected' : '' %>>Completed</option>
        <option value="Failed" <%= paymentFilter === 'Failed' ? 'selected' : '' %>>Failed</option>
      </select>
      <select name="sort" class="p-2 border rounded">
        <option value="-createdOn" <%= sort === '-createdOn' ? 'selected' : '' %>>Newest First</option>
        <option value="createdOn" <%= sort === 'createdOn' ? 'selected' : '' %>>Oldest First</option>
        <option value="finalAmount" <%= sort === 'finalAmount' ? 'selected' : '' %>>Price: Low to High</option>
        <option value="-finalAmount" <%= sort === '-finalAmount' ? 'selected' : '' %>>Price: High to Low</option>
      </select>
      <button type="submit" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Apply</button>
      <a href="/admin/orders/clear" class="bg-gray-500 text-white p-2 rounded hover:bg-gray-600">Clear Filters</a>
    </form>

    <!-- Orders Table -->
    <table class="w-full border-collapse bg-white shadow-md">
      <thead>
        <tr class="bg-gray-200">
          <th class="p-2">Order ID</th>
          <th class="p-2">User</th>
          <th class="p-2">Date</th>
          <th class="p-2">Status</th>
          <th class="p-2">Payment Status</th>
          <th class="p-2">Total</th>
          <th class="p-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (orders.length === 0) { %>
          <tr>
            <td colspan="7" class="p-2 border text-center text-gray-500">No orders found</td>
          </tr>
        <% } else { %>
          <% orders.forEach(order => { %>
            <tr>
              <td class="p-2 border"><%= order.orderId || 'N/A' %></td>
              <td class="p-2 border"><%= order.user && order.user.name ? order.user.name : 'N/A' %></td>
              <td class="p-2 border"><%= order.createdOn ? new Date(order.createdOn).toLocaleDateString() : 'N/A' %></td>
              <td class="p-2 border"><%= order.status || 'N/A' %></td>
              <td class="p-2 border"><%= order.paymentStatus || 'N/A' %></td>
              <td class="p-2 border">$<%= order.finalAmount ? order.finalAmount.toFixed(2) : '0.00' %></td>
              <td class="p-2 border">
                <a href="/admin/orders/<%= order.orderId %>" class="text-blue-500 hover:underline">View</a>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-4 flex justify-center">
      <% if (currentPage > 1) { %>
        <a href="/admin/orders?page=<%= currentPage - 1 %>&limit=<%= limit %>&search=<%= search %>&status=<%= statusFilter %>&payment=<%= paymentFilter %>&sort=<%= sort %>" class="p-2 bg-blue-500 text-white rounded mx-1 hover:bg-blue-600">Previous</a>
      <% } %>
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="/admin/orders?page=<%= i %>&limit=<%= limit %>&search=<%= search %>&status=<%= statusFilter %>&payment=<%= paymentFilter %>&sort=<%= sort %>" class="p-2 <%= currentPage === i ? 'bg-blue-700' : 'bg-blue-500' %> text-white rounded mx-1 hover:bg-blue-600"><%= i %></a>
      <% } %>
      <% if (currentPage < totalPages) { %>
        <a href="/admin/orders?page=<%= currentPage + 1 %>&limit=<%= limit %>&search=<%= search %>&status=<%= statusFilter %>&payment=<%= paymentFilter %>&sort=<%= sort %>" class="p-2 bg-blue-500 text-white rounded mx-1 hover:bg-blue-600">Next</a>
      <% } %>
    </div>
  </div>

  <%- include("../partials/admin/footer") %>
</body>
</html>